{% extends 'partials/base.html' %}
{% load static %}

{% block extra_css %}{% endblock %}
{% block contents %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">

                <h4 class="card-title">Пример таблицы</h4>
                <p class="card-title-desc">Здесь вы можете просмотреть данные с таблицы, скачать их в формате excel и
                    pdf. Есть режим поиска и сортировки,
                    а также таблица разделена на страницы.
                </p>
                <form class="row gy-2 gx-3 align-items-center">
                    <div class="col-lg-2">
                        <label class="visually-hidden" for="autoSizingSelect"></label>
                        <select class="form-select" id="autoSizingSelect">
                            <option selected>Выберите год...</option>
                            <option value="1">2022</option>
                            <option value="2">2021</option>
                            <option value="3">2020</option>
                        </select>
                    </div>
                    <div class="col-lg-2">
                        <label class="visually-hidden" for="autoSizingSelect"></label>
                        <select class="form-select" id="autoSizingSelect">
                            <option selected>Выберите месяц...</option>
                            <option value="1">Январь</option>
                            <option value="1">Февраль</option>
                            <option value="1">Март</option>
                            <option value="1">Апрель</option>
                            <option value="1">Май</option>
                            <option value="1">Июнь</option>
                            <option value="1">Июль</option>
                            <option value="1">Август</option>
                            <option value="1">Сентябрь</option>
                            <option value="1">Октябрь</option>
                            <option value="2">Ноябрь</option>
                            <option value="3">Декабрь</option>
                        </select>
                    </div>
<!--                    <div class="col-lg-4">-->
<!--                        <button id="datable1" type="submit" class="btn btn-primary w-md">Скачать Excel</button>-->
<!--                    </div>-->
                </form>
                <div class="mt-3">
                    <table id="datatable-buttons" class="table text-center table-bordered dt-responsive nowrap w-100">
                        <thead>
                            <tr>
                                <th>Установка</th>
                                <th>Место отбора анализов</th>
                                <th>Контролируемая вода</th>
                                <th>Контролируемый параметр</th>
                                <th>Показатель</th>
                                <th>Производные коэффициенты и метрики, полученные из анализов</th>
                                <th>Задачи и рекомендации по нормализации качества воды</th>
                                <th>Ответственный и срок выполнения задачи</th>
                                <th>Исполнители</th>
                                <th>Причины невыполнения задач</th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for task in tasks %}
                                <tr>
                                    <td>{{ task.plant_unit }}</td>
                                    <td>{{ task.sampling_site }}</td>
                                    <td>{{ task.water_type }}</td>
                                    <td>{{ task.comp_title }}</td>
                                    <td>{{ task.comp_value }}</td>
                                    <td id="area-sparkline-chart-1"
                                        class="apex-charts"></td>
                                    <td>{{ task.title }}</td>
                                    <td>
                                        {{ task.responsible.first_name }} {{ task.responsible.last_name }}
                                        <br>{{ task.deadline|date:"d.m.Y H:i" }}
                                    </td>
                                    <td class="px-1">
                                        {% for change in task.changes.all %}
                                            {% if 'изменил исполнителя' in change.text %}
                                                <ul class="px-3 mb-2 text-start"><li>{{ change.changed_to }}<br>{{ change.updated_at|date:"d.m.Y" }}</li></ul>
                                            {% endif %}
                                        {% endfor %}
                                    </td>
                                    <td class="px-1">
                                        {% for change in task.changes.all %}
                                                <ul class="px-3 mb-2 text-start"><li class="hide_item">{% if change.failure_reason %}{{ change.failure_reason|truncatechars:20 }}{% endif %}</li></ul>
                                        {% endfor %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div> <!-- end col -->
</div> <!-- end row -->

{% endblock %}

{% block extra_javascript %}
<!-- apexcharts -->
<script src="{% static 'libs/apexcharts/dist/apexcharts.min.js'%}"></script>
<!-- crypto dash init js -->
<script src="{% static 'js/pages/crypto-dashboard.init.js'%}"></script>

<!-- Required datatable js -->
<script src="{% static 'libs/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<!-- Buttons examples -->
<script src="{% static 'libs/datatables.net-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js' %}"></script>
<script src="{% static 'libs/jszip/dist/jszip.min.js' %}"></script>
<script src="{% static 'libs/pdfmake/build/pdfmake.min.js' %}"></script>
<script src="{% static 'libs/pdfmake/build/vfs_fonts.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.html5.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.print.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.colVis.min.js' %}"></script>

<!-- Responsive examples -->
<script src="{% static 'libs/datatables.net-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js' %}"></script>

<!-- Datatable init js -->
<script src="{% static 'js/pages/datatables.init.js' %}"></script>

<script>$('.hide_item:empty').parent().hide()</script>
{% endblock %}