{% extends 'partials/base.html' %} {% load static %} {% block extra_css %}
<!-- dragula css -->
<link href="{% static 'libs/dragula/dist/dragula.min.css' %}" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" type="text/css" href="{% static 'libs/toastr/build/toastr.min.css' %}">

<link href="{% static 'css/preloader.css' %}" rel="stylesheet" type="text/css"/>
<link href="{% static 'libs/select2/dist/css/select2.min.css'%}" rel="stylesheet" type="text/css"/>
<link href="{% static 'libs/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css'%}" rel="stylesheet" type="text/css">
<link href="{% static 'libs/bootstrap-timepicker/css/bootstrap-timepicker.min.css'%}" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="{% static 'libs/@chenfengyuan/datepicker/dist/datepicker.min.css'%}" type="text/css"/> {% endblock %} {% block contents %}

<div id="overlay">
    <div class="socket">
        <div class="gel center-gel">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c1 r1">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c2 r1">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c3 r1">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c4 r1">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c5 r1">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c6 r1">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>

        <div class="gel c7 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>

        <div class="gel c8 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c9 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c10 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c11 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c12 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c13 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c14 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c15 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c16 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c17 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c18 r2">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c19 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c20 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c21 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c22 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c23 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c24 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c25 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c26 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c28 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c29 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c30 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c31 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c32 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c33 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c34 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c35 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c36 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>
        <div class="gel c37 r3">
            <div class="hex-brick h1"></div>
            <div class="hex-brick h2"></div>
            <div class="hex-brick h3"></div>
        </div>

    </div>
</div>

<div class="row">
    <div class="col-lg-3">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4">Запланировано</h4>
                <div id="task-2">
                    <div id="upcoming-task" class="pb-1 task-list">
                        <!-- task card -->
                        {% for task in tasks %}
                            {% if task.status_id == 1 %}
                                {% if task.user == request.user %}
                                    <div class="card task-box" id="{{ task.id }}">
                                        <div class="card-body">
                                            <div class="float-end ms-2">
                                                <span class="badge rounded-pill badge-soft-secondary font-size-12" id="task-status">{{ task.status }}</span>
                                            </div>

                                            <div>
                                                <p class="fw-bold mb-2">
                                                    <a href="" class="text-dark open_task" id="{{ task.id }}"
                                                       data-popup-url="{% url 'tasks-update' task.pk %}" onclick="editTask(this.id)">
                                                        {{ task.title }} для компонента '{{ task.comp_title }}'
                                                    </a>
                                                </p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Место отбора проб: {{ task.sampling_site.title }}</p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Установка: {{ task.plant_unit.title }}</p>
                                                <p class="text-muted mb-2">Выполнить до: {{ task.deadline }}</p>
                                            </div>

                                            <div class="avatar-group float-start task-assigne">
                                                <div class="avatar-group-item">
                                                    <img src="{% static 'images/users/avatar-1.jpg'%}" alt="" class="rounded-circle avatar-xs">
                                                    Исполнитель: {% if task.user %}{{ task.user }}{% else %}Не назначен{% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% elif request.user.is_superuser %}
                                    <div class="card task-box" id="{{ task.id }}">
                                        <div class="card-body">
                                            <div class="float-end ms-2">
                                                <span class="badge rounded-pill badge-soft-secondary font-size-12" id="task-status">{{ task.status }}</span>
                                            </div>

                                            <div>
                                                <p class="fw-bold mb-2">
                                                    <a href="" class="text-dark open_task" id="{{ task.id }}"
                                                       data-popup-url="{% url 'tasks-update' task.pk %}" onclick="editTask(this.id)">
                                                        {{ task.title }} для компонента '{{ task.comp_title }}'
                                                    </a>
                                                </p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Место отбора проб: {{ task.sampling_site.title }}</p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Установка: {{ task.plant_unit.title }}</p>
                                                <p class="text-muted mb-2">Выполнить до: {{ task.deadline }}</p>
                                            </div>

                                            <div class="avatar-group float-start task-assigne">
                                                <div class="avatar-group-item">
                                                    <img src="{% static 'images/users/avatar-1.jpg'%}" alt="" class="rounded-circle avatar-xs">
                                                    Исполнитель: {% if task.user %}{{ task.user }}{% else %}Не назначен{% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <!-- end task card -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end col -->
    <div class="col-lg-3">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4">В работе</h4>
                <div id="task-2">
                    <div id="inprogress-task" class="pb-1 task-list">
                        <!-- task card -->
                        {% for task in tasks %}
                            {% if task.status_id == 2 %}
                                {% if task.user == request.user %}
                                    <div class="card task-box" id="{{ task.id }}">
                                        <div class="card-body">
                                            <div class="float-end ms-2">
                                                <span class="badge rounded-pill badge-soft-primary font-size-12" id="task-status">{{ task.status }}</span>
                                            </div>
                                            <div>
                                                <p class="fw-bold mb-2">
                                                    <a href="" class="text-dark open_task" id="{{ task.id }}"
                                                       data-popup-url="{% url 'tasks-update' task.pk %}" onclick="editTask(this.id)">
                                                        {{ task.title }} для компонента '{{ task.comp_title }}'
                                                    </a>
                                                </p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Место отбора проб: {{ task.sampling_site.title }}</p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Установка: {{ task.plant_unit.title }}</p>
                                                <p class="text-muted mb-2">Выполнить до: {{ task.deadline }}</p>
                                            </div>
                                            <div class="avatar-group float-start task-assigne">
                                                <div class="avatar-group-item">
                                                    <img src="{% static 'images/users/avatar-1.jpg'%}" alt="" class="rounded-circle avatar-xs">
                                                    Исполнитель: {% if task.user %}{{ task.user }}{% else %}Не назначен{% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% elif request.user.is_superuser %}
                                    <div class="card task-box" id="{{ task.id }}">
                                        <div class="card-body">
                                            <div class="float-end ms-2">
                                                <span class="badge rounded-pill badge-soft-primary font-size-12" id="task-status">{{ task.status }}</span>
                                            </div>
                                            <div>
                                                <p class="fw-bold mb-2">
                                                    <a href="" class="text-dark open_task" id="{{ task.id }}"
                                                       data-popup-url="{% url 'tasks-update' task.pk %}" onclick="editTask(this.id)">
                                                        {{ task.title }} для компонента '{{ task.comp_title }}'
                                                    </a>
                                                </p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Место отбора проб: {{ task.sampling_site.title }}</p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Установка: {{ task.plant_unit.title }}</p>
                                                <p class="text-muted mb-2">Выполнить до: {{ task.deadline }}</p>
                                            </div>
                                            <div class="avatar-group float-start task-assigne">
                                                <div class="avatar-group-item">
                                                    <img src="{% static 'images/users/avatar-1.jpg'%}" alt="" class="rounded-circle avatar-xs">
                                                    Исполнитель: {% if task.user %}{{ task.user }}{% else %}Не назначен{% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <!-- end task card -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end col -->
    <div class="col-lg-3">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4">На проверке</h4>
                <div id="task-2">
                    <div id="test-task" class="pb-1 task-list">
                        <!-- task card -->
                        {% for task in tasks %}
                            {% if task.status_id == 3 %}
                                {% if task.user == request.user %}
                                    <div class="card task-box" id="{{ task.id }}">
                                        <div class="card-body">
                                            <div class="float-end ms-2">
                                                <span class="badge rounded-pill badge-soft-warning font-size-12" id="task-status">{{ task.status }}</span>
                                            </div>
                                            <div>
                                                <p class="fw-bold mb-2">
                                                    <a href="" class="text-dark open_task" id="{{ task.id }}"
                                                       data-popup-url="{% url 'tasks-update' task.pk %}" onclick="editTask(this.id)">
                                                        {{ task.title }} для компонента '{{ task.comp_title }}'
                                                    </a>
                                                </p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Место отбора проб: {{ task.sampling_site.title }}</p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Установка: {{ task.plant_unit.title }}</p>
                                                <p class="text-muted mb-2">Выполнить до: {{ task.deadline }}</p>
                                            </div>
                                            <div class="avatar-group float-start task-assigne">
                                                <div class="avatar-group-item">
                                                    <img src="{% static 'images/users/avatar-1.jpg'%}" alt="" class="rounded-circle avatar-xs">
                                                    Исполнитель: {% if task.user %}{{ task.user }}{% else %}Не назначен{% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% elif request.user.is_superuser %}
                                    <div class="card task-box" id="{{ task.id }}">
                                        <div class="card-body">
                                            <div class="float-end ms-2">
                                                <span class="badge rounded-pill badge-soft-warning font-size-12" id="task-status">{{ task.status }}</span>
                                            </div>
                                            <div>
                                                <p class="fw-bold mb-2">
                                                    <a href="" class="text-dark open_task" id="{{ task.id }}"
                                                       data-popup-url="{% url 'tasks-update' task.pk %}" onclick="editTask(this.id)">
                                                        {{ task.title }} для компонента '{{ task.comp_title }}'
                                                    </a>
                                                </p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Место отбора проб: {{ task.sampling_site.title }}</p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Установка: {{ task.plant_unit.title }}</p>
                                                <p class="text-muted mb-2">Выполнить до: {{ task.deadline }}</p>
                                            </div>
                                            <div class="avatar-group float-start task-assigne">
                                                <div class="avatar-group-item">
                                                    <img src="{% static 'images/users/avatar-1.jpg'%}" alt="" class="rounded-circle avatar-xs">
                                                    Исполнитель: {% if task.user %}{{ task.user }}{% else %}Не назначен{% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <!-- end task card -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end col -->
    <div class="col-lg-3">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4">Выполнено</h4>
                <div id="task-3">
                    <div id="complete-task" class="pb-1 task-list">
                        <!-- task card -->
                        {% for task in tasks %}
                            {% if task.status_id == 4 %}
                                {% if task.user == request.user %}
                                    <div class="card task-box" id="{{ task.id }}">
                                        <div class="card-body">
                                            <div class="float-end ms-2">
                                                <span class="badge rounded-pill badge-soft-success font-size-12" id="task-status">{{ task.status }}</span>
                                            </div>
                                            <div>
                                                <p class="fw-bold mb-2">
                                                    <a href="" class="text-dark open_task" id="{{ task.id }}"
                                                       data-popup-url="{% url 'tasks-update' task.pk %}" onclick="editTask(this.id)">
                                                        {{ task.title }} для компонента '{{ task.comp_title }}'
                                                    </a>
                                                </p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Место отбора проб: {{ task.sampling_site.title }}</p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Установка: {{ task.plant_unit.title }}</p>
                                                <p class="text-muted mb-2">Выполнить до: {{ task.deadline }}</p>
                                            </div>
                                            <div class="avatar-group float-start task-assigne">
                                                <div class="avatar-group-item">
                                                    <img src="{% static 'images/users/avatar-1.jpg'%}" alt="" class="rounded-circle avatar-xs">
                                                    Исполнитель: {% if task.user %}{{ task.user }}{% else %}Не назначен{% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% elif request.user.is_superuser %}
                                    <div class="card task-box" id="{{ task.id }}">
                                        <div class="card-body">
                                            <div class="float-end ms-2">
                                                <span class="badge rounded-pill badge-soft-success font-size-12" id="task-status">{{ task.status }}</span>
                                            </div>
                                            <div>
                                                <p class="fw-bold mb-2">
                                                    <a href="" class="text-dark open_task" id="{{ task.id }}"
                                                       data-popup-url="{% url 'tasks-update' task.pk %}" onclick="editTask(this.id)">
                                                        {{ task.title }} для компонента '{{ task.comp_title }}'
                                                    </a>
                                                </p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Место отбора проб: {{ task.sampling_site.title }}</p>
                                                <p class="text-muted mb-2" style="line-height: 15px;">Установка: {{ task.plant_unit.title }}</p>
                                                <p class="text-muted mb-2">Выполнить до: {{ task.deadline }}</p>
                                            </div>
                                            <div class="avatar-group float-start task-assigne">
                                                <div class="avatar-group-item">
                                                    <img src="{% static 'images/users/avatar-1.jpg'%}" alt="" class="rounded-circle avatar-xs">
                                                    Исполнитель: {% if task.user %}{{ task.user }}{% else %}Не назначен{% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- end col -->
</div>
<!-- end row -->

<div class="modal fade" id="staticBackdrop" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <form action="" method="POST">
            <input type="hidden" name="id" id="uid" data-url="{% url 'tasks-kanbanboard' %}">
            {% csrf_token %}
            <div class="modal-content form">
            </div>
        </form>
    </div>
</div>


{% endblock %} {% block extra_javascript %}
<!-- Kanban -->
<script src="{% static 'libs/dragula/dist/dragula.min.js' %}"></script>
<script src="{% static 'libs/jquery-validation/dist/jquery.validate.min.js' %}"></script>
<script src="{% static 'js/pages/task-kanban.init.js' %}"></script>
<script src="{% static 'js/pages/task-form.init.js' %}"></script>
<script src="{% static 'libs/toastr/build/toastr.min.js' %}"></script>
<script src="{% static 'js/pages/toastr.init.js' %}"></script>

<script src="{% static 'libs/select2/dist/js/select2.min.js'%}"></script>
<script src="{% static 'libs/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js'%}"></script>
<script src="{% static 'libs/bootstrap-timepicker/js/bootstrap-timepicker.min.js'%}"></script>
<script src="{% static 'libs/@chenfengyuan/datepicker/dist/datepicker.min.js'%}"></script>
<!-- form advanced init -->
<script src="{% static 'js/pages/form-advanced.init.js'%}"></script>

<script>
    $(document).on("click", ".open_task", function (e) {
        e.preventDefault();
        let $popup = $("#staticBackdrop");
        let popup_url = $(this).data("popup-url");
        $(".modal-content", $popup).load(popup_url, function () {
          $popup.modal("show");
        });
    });
    function editTask(event){
        let task_id = document.getElementById("uid");
        task_id.setAttribute("value", event);

        {#let uri = window.location.href;#}
        {#let $popup = $('#staticBackdrop');#}
        {#$popup.on('show.bs.modal', function () {#}
        {#    history.pushState({}, '', uri + '/' + event);#}
        //});
        {#$popup.on('hide.bs.modal', function () {#}
        {#    history.pushState({}, '', uri);#}
        //});

        $.ajax({
            type: 'GET',
            data: {
                'taskid': event
            },
            success: function (result) {
                console.log('Success!');
            },
            error: function (result) {
                console.log('Error!');
            }
        });
    }
</script>


{% endblock %}